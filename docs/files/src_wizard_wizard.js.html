<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\wizard\wizard.js - Sideshow</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http://github.com/fortesinformatica/sideshow/examples/images/sideshow-logo.svg" title="Sideshow"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.3.4</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/CloseButton.html">CloseButton</a></li>
            
                <li><a href="../classes/CompositeMask.html">CompositeMask</a></li>
            
                <li><a href="../classes/CornerPart.html">CornerPart</a></li>
            
                <li><a href="../classes/FadableItem.html">FadableItem</a></li>
            
                <li><a href="../classes/HidableItem.html">HidableItem</a></li>
            
                <li><a href="../classes/Mask.Arrow.html">Mask.Arrow</a></li>
            
                <li><a href="../classes/Mask.Arrows.html">Mask.Arrows</a></li>
            
                <li><a href="../classes/Mask.ControlVariables.html">Mask.ControlVariables</a></li>
            
                <li><a href="../classes/Mask.DetailsPanel.html">Mask.DetailsPanel</a></li>
            
                <li><a href="../classes/Mask.StepDescription.html">Mask.StepDescription</a></li>
            
                <li><a href="../classes/Mask.StepDescriptionNextButton.html">Mask.StepDescriptionNextButton</a></li>
            
                <li><a href="../classes/Mask.Subject.html">Mask.Subject</a></li>
            
                <li><a href="../classes/Mask.SubjectMask.html">Mask.SubjectMask</a></li>
            
                <li><a href="../classes/Mask.Wizard.html">Mask.Wizard</a></li>
            
                <li><a href="../classes/Mask.WizardMenu.html">Mask.WizardMenu</a></li>
            
                <li><a href="../classes/Part.html">Part</a></li>
            
                <li><a href="../classes/Polling.html">Polling</a></li>
            
                <li><a href="../classes/Screen.html">Screen</a></li>
            
                <li><a href="../classes/SS.html">SS</a></li>
            
                <li><a href="../classes/SSException.html">SSException</a></li>
            
                <li><a href="../classes/VisualItem.html">VisualItem</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\wizard\wizard.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
    /**
    Represents a tutorial

    @class Wizard
    @@initializer
    @param {Object} wizardConfig                          The wizard configuration object                        
    **/
    var Wizard = jazz.Class(function(wizardConfig) {
        this.name = wizardConfig.name;
        this.title = wizardConfig.title;
        this.description = wizardConfig.description;
        this.estimatedTime = wizardConfig.estimatedTime;
        this.affects = wizardConfig.affects;
        this.preparation = wizardConfig.preparation;
        this.listeners = wizardConfig.listeners;
        this.showStepPosition = wizardConfig.showStepPosition;
        this.relatedWizards = wizardConfig.relatedWizards;
    });

    /**
    A function to prepare the environment for running a wizard (e.g. redirecting to some screen)

    @@field preparation
    @type Function
    **/
    Wizard.field(&quot;preparation&quot;);

    /**
    An object with listeners to this wizard (e.g. beforeWizardStarts, afterWizardEnds)

    @@field listeners
    @type Object
    **/
    Wizard.field(&quot;listeners&quot;);

    /**
    A configuration flag that defines if the step position (e.g. 2/10, 3/15, 12/12) will be shown

    @@field showStepPosition
    @type boolean
    **/
    Wizard.field(&quot;showStepPosition&quot;);

    /**
    An array with related wizards names. These wizards are listed after the ending of the current wizard.

    @@field relatedWizards
    @type Array
    **/
    Wizard.field(&quot;relatedWizards&quot;);

    /**
    The wizard unique name (used internally as an identifier)

    @@field name
    @type String
    **/
    Wizard.field(&quot;name&quot;);

    /**
    The wizard title (will be shown in the list of available wizards)

    @@field title
    @type String
    **/
    Wizard.field(&quot;title&quot;);

    /**
    The wizard description (will be shown in the list of available wizards)

    @@field description
    @type String
    **/
    Wizard.field(&quot;description&quot;);

    /**
    The wizard estimated completion time (will be shown in the list of available wizards)

    @@field estimatedTime
    @type String
    **/
    Wizard.field(&quot;estimatedTime&quot;);

    /**
    A collection of rules to infer whether a wizard should be available in a specific screen

    @@field affects
    @type Array
    **/
    Wizard.field(&quot;affects&quot;);

    /**
    The sequence of steps for this wizard

    @@field storyline
    @private
    @type Object
    **/
    Wizard.field(&quot;_storyline&quot;);

    /**
    Points to the current step object in a playing wizard

    @@field currentStep
    @type Object
    **/
    Wizard.field(&quot;currentStep&quot;);

    /**
    Sets the storyline for the wizard

    @method storyLine
    **/
    Wizard.method(&quot;storyLine&quot;, function(storyline) {
        this._storyline = storyline;
    });

    /**
    Runs the wizard

    @method play
    **/
    Wizard.method(&quot;play&quot;, function() {
        var wiz = this;

        Polling.enqueue(&quot;check_composite_mask_subject_changes&quot;, function() {
            Mask.CompositeMask.singleInstance.pollForSubjectChanges();
        });

        Polling.enqueue(&quot;check_arrow_changes&quot;, function() {
            Arrows.pollForArrowsChanges();
        });

        //Checks if the wizard has a storyline
        if (!this._storyline) throw new SSException(&quot;201&quot;, &quot;A wizard needs to have a storyline.&quot;);
        var steps = this._storyline.steps;

        //Checks if the storyline has at least one step
        if (steps.length === 0) throw new SSException(&quot;202&quot;, &quot;A storyline must have at least one step.&quot;);

        DetailsPanel.singleInstance.render();

        StepDescription.singleInstance.render();

        var listeners = this.listeners;
        if (listeners &amp;&amp; listeners.beforeWizardStarts) listeners.beforeWizardStarts();

        flags.changingStep = true;
        this.showStep(steps[0], function() {
            //Releases the polling for checking any changes in the current subject
            //flags.lockMaskUpdate = false;

            //Register the function that checks the completing of a step in the polling queue
            Polling.enqueue(&quot;check_completed_step&quot;, function() {
                wiz.pollForCheckCompletedStep();
            });
        });

        Mask.CompositeMask.singleInstance.fadeIn();
    });

    /**
    Shows a specific step

    @method showStep
    @param {Object} step                                  The step to be shown
    @param {Function} callback                            A callback function to be called
    **/
    Wizard.method(&quot;showStep&quot;, function(step, callback) {
        flags.skippingStep = false;

        Arrows.clear();

        if (this.currentStep &amp;&amp; this.currentStep.listeners &amp;&amp; this.currentStep.listeners.afterStep)
            this.currentStep.listeners.afterStep();

        function skipStep(wiz) {
            flags.skippingStep = true;
            this.next();
        }

        if (step &amp;&amp; step.listeners &amp;&amp; step.listeners.beforeStep)
            step.listeners.beforeStep();

        //The shown step is, of course, the current
        this.currentStep = step;

        //If the step has a skipIf evaluator and it evaluates to true, we&#x27;ll skip to the next step!
        if (step.skipIf &amp;&amp; step.skipIf())
            skipStep(this);

        if (flags.changingStep &amp;&amp; !flags.skippingStep) {
            //Sets the current subject and updates its dimension and position
            if (step.subject)
                SS.setSubject(step.subject);
            else
                SS.setEmptySubject();
            //Updates the mask
            Mask.CompositeMask.singleInstance.update(Subject.position, Subject.dimension, Subject.borderRadius);

            var sm = Mask.SubjectMask.singleInstance;
            sm.fadeOut(function() {
                if (step.lockSubject) sm.show(true);
            });
            //The details panel (that wraps the step description and arrow) is shown
            DetailsPanel.singleInstance.show();
            //Repositionate the details panel depending on the remaining space in the screen
            DetailsPanel.singleInstance.positionate();
            //Sets the description properties (text, title and step position)
            var description = StepDescription.singleInstance;
            var text = step.text;
            text = text instanceof Function ? SS.heredoc(text) : text;
            if (step.format == &quot;markdown&quot;) {
                description.setHTML(new markdown.Converter().makeHtml(text));
            } else
                description.setText(text);

            description.setTitle(step.title);
            description.setStepPosition((this.getStepPosition() + 1) + &quot;/&quot; + this._storyline.steps.length);
            //If this step doesn&#x27;t have its own passing conditions/evaluators, or the flag &quot;showNextButton&quot; is true, then, the button is visible
            if (step.showNextButton || step.autoContinue === false || !(step.completingConditions &amp;&amp; step.completingConditions.length &gt; 0)) {
                var nextStep = this._storyline.steps[this.getStepPosition() + 1];
                if (nextStep) {
                    description.nextButton.setText(getString(strings.next) + &quot;: &quot; + this._storyline.steps[this.getStepPosition() + 1].title);
                } else {
                    description.nextButton.setText(getString(strings.finishWizard));
                }
                description.nextButton.show();

                if (step.autoContinue === false) description.nextButton.disable();
            } else {
                description.nextButton.hide();
            }

            if (step.targets &amp;&amp; step.targets.length &gt; 0) {
                Arrows.setTargets(step.targets);
                Arrows.render();
                Arrows.positionate();
                Arrows.fadeIn();
            }

            //Step Description is shown, but is transparent yet (since we need to know its dimension to positionate it properly)
            description.show(true);
            if(!Mask.CompositeMask.singleInstance.scrollIfNecessary(Subject.position, Subject.dimension)){
                description.positionate();
                //Do a simple fade in for the description box
                description.fadeIn();
            }
            

            //If a callback is passed, call it    
            if (callback) callback();
            flags.changingStep = false;
        }
    });

    /**
    Shows the next step of the wizard

    @method next 
    @param {Function} callback                            A callback function to be called
    **/
    Wizard.method(&quot;next&quot;, function(callback, nextStep) {
        if (!flags.changingStep || flags.skippingStep) {
            flags.changingStep = true;
            var currentStep = this.currentStep;
            nextStep = nextStep || this._storyline.steps[this.getStepPosition(this.currentStep) + 1];
            var self = this;

            this.hideStep(function() {
                if (nextStep) self.showStep(nextStep, function() {
                    if (callback) callback();
                });
                else {
                    if (currentStep &amp;&amp; currentStep.listeners &amp;&amp; currentStep.listeners.afterStep)
                        currentStep.listeners.afterStep();

                    var completedWizard = currentWizard;
                    currentWizard = null;
                    var listeners = self.listeners;
                    if (listeners &amp;&amp; listeners.afterWizardEnds) listeners.afterWizardEnds();

                    if (!SS.showRelatedWizardsList(completedWizard)) SS.close();
                }
            });
        }
    });

    /**
    Hides the step

    @method hideStep
    @param {Function} callback                            A callback function to be called in the ending of the hiding process
    **/
    Wizard.method(&quot;hideStep&quot;, function(callback) {
        StepDescription.singleInstance.fadeOut(function() {
            DetailsPanel.singleInstance.hide();
        });
        Arrows.fadeOut();
        Mask.SubjectMask.singleInstance.update(Subject.position, Subject.dimension, Subject.borderRadius);
        Mask.SubjectMask.singleInstance.fadeIn(callback);
    });

    /**
    Returns the position of the step passed as argument or (by default) the current step

    @method getStepPosition
    @param {Object} step                                  The step object to get position
    **/
    Wizard.method(&quot;getStepPosition&quot;, function(step) {
        return this._storyline.steps.indexOf(step || this.currentStep);
    });

    /**
    Checks if a wizard should be shown in the current context (running each evaluator defined for this wizard)

    @method isEligible
    @return {boolean}                                     A boolean indicating if this wizard should be available in the current context
    **/
    Wizard.method(&quot;isEligible&quot;, function() {
        var l = global.location;

        function isEqual(a, b, caseSensitive) {
            return (caseSensitive) ? a === b : a.toLowerCase() === b.toLowerCase();
        }

        for (var c = 0; c &lt; this.affects.length; c++) {
            var condition = this.affects[c];
            if (condition instanceof Function) {
                if (condition()) return true;
            } else if (condition instanceof Object) {
                if (&quot;route&quot; in condition) {
                    var route = l.pathname + l.search + l.hash;
                    if (isEqual(route, condition.route, condition.caseSensitive)) return true;
                }

                if (&quot;hash&quot; in condition) {
                    if (isEqual(location.hash, condition.hash, condition.caseSensitive)) return true;
                }

                if (&quot;url&quot; in condition) {
                    if (isEqual(location.href, condition.url, condition.caseSensitive)) return true;
                }
            }
        }
        return false;
    });

    /**
    Checks if the current user already watched this wizard

    @method isAlreadyWatched
    @return {boolean}                                     A boolean indicating if the user watched this wizard
    @@todo Implement this method...
    **/
    Wizard.method(&quot;isAlreadyWatched&quot;, function() {
        //ToDo
        return false;
    });

    /**
    A Polling function to check if the current step is completed

    @method pollForCheckCompletedStep
    **/
    Wizard.method(&quot;pollForCheckCompletedStep&quot;, function() {
        var conditions = this.currentStep.completingConditions;
        if (conditions &amp;&amp; conditions.length &gt; 0 &amp;&amp; !flags.skippingStep) {
            var completed = true;
            for (var fn = 0; fn &lt; conditions.length; fn++) {
                var completingCondition = conditions[fn];
                if (!completingCondition()) completed = false;
            }

            if (completed) {
                if (this.currentStep.autoContinue === false) StepDescription.singleInstance.nextButton.enable();
                else currentWizard.next();
            }
        }
    });


    Wizard.method(&quot;prepareAndPlay&quot;, function(){
        currentWizard = this;

        if (!this.isEligible()) {
            if (this.preparation)
                this.preparation(function() {
                    currentWizard.play();
                });
            else
                throw new SSException(&quot;203&quot;, &quot;This wizard is not eligible neither has a preparation function.&quot;);
        } else this.play();
    });
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
